# Мафия

В данном проекте представлена реализация игры Мафия на основе клиенто-сервисного приложения при помощи gRpc.

На серве происходит основной контроль игры, к серверу подкючаются клиенты, а сервер распределяет их на комнаты и стартует игру.

Существует три вида ролей, которые могут получить клиенты:

1) Мафия - убивает ночью любого игрока (возможно себя), выигрывает, когда мирных жителей небольше, чем мафий
2) Комиссар - ночью может узнать роль любого игрока, днем может опубликовать проверки.
3) Мирный житель - днем участвует в голосование, в котором умирает игрок получивший наибольшее число голосов.

Также реализованны боты, которые делают рандомные действия.

# Реализация

При подключение к игре клиенты получают stream канал, по которому получают все логи по игре от сервера (реализовано при помощи oneof). Так же клиенты могут дергать разные rpc ручки при необходимости, например мафия посылает rpc запрос при убийстве и т.д. 

# Чат

Так же реализован чат, игроки могут общаться в чате днем, чат реализован при помощи RabbitMq, для одной комнаты создается собственная очередь, туда добавляются новые сообщения в конец, а затем рассылаются всем из начала очереди.

# Запуск

Запускать возможно при помощи докер контейнеров. Сначала надо собрать контейнеры для клиентов.

```bash
docker build . --tag client -f docker/client.dockerfile 
docker build . --tag client_bot -f docker/clientBot.dockerfile 
```
Далее можно запускать проект, для начала надо стартануть сервер. Количество игроков в одной комнате можно понять в docker-compose.yml в аргументе numbOfPl, сейчас количество игроков в комнате 4.

```bash
docker-compose up --build
```
Затем можно подключать обычных клиентов и ботов. 

Клиенты подключаются так:
```bash
docker run --net=host -it client
```
Боты подключаются так:
```bash
docker run --net=host -it client_bot
```
Для проверки рекомендовано подключать 2-ух клиентов и 2-х ботов, чтобы с высокой вероятностью получить активную роль.
